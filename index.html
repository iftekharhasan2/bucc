<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BUG HUNT â€” CSE Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:        #0d1117;
      --surface:   #161b22;
      --border:    #30363d;
      --green:     #39ff14;
      --green-dim: #1a7a00;
      --green-mid: #00cc00;
      --amber:     #ffb800;
      --red:       #ff4444;
      --blue:      #58a6ff;
      --purple:    #bc8cff;
      --comment:   #8b949e;
      --text:      #e6edf3;
      --glow-g:    0 0 12px #39ff1488, 0 0 30px #39ff1433;
      --glow-a:    0 0 12px #ffb80088;
      --glow-r:    0 0 12px #ff444488;
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    html, body { width:100%; height:100%; overflow:hidden; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Fira Code', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* Matrix rain */
    #matrix-bg {
      position:fixed; inset:0; z-index:0;
      opacity:0.06; pointer-events:none;
    }

    /* CRT scanlines */
    body::before {
      content:'';
      position:fixed; inset:0;
      background:repeating-linear-gradient(
        0deg,transparent,transparent 3px,
        rgba(0,0,0,0.12) 3px,rgba(0,0,0,0.12) 4px
      );
      pointer-events:none; z-index:500;
    }

    /* â”€â”€ Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shell {
      position:relative; z-index:10;
      display:flex; flex-direction:column;
      width:100vw; height:100vh;
      max-width:1100px;
      padding:8px 10px;
    }

    /* â”€â”€ Title bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .title-bar {
      display:flex; align-items:center; gap:10px;
      padding:6px 14px;
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:8px 8px 0 0;
      flex-shrink:0;
    }

    .dot { width:11px;height:11px;border-radius:50%;flex-shrink:0; }
    .dot.r{background:#ff5f57;box-shadow:0 0 4px #ff5f5788;}
    .dot.y{background:#febc2e;box-shadow:0 0 4px #febc2e88;}
    .dot.g{background:#28c840;box-shadow:0 0 4px #28c84088;}

    .title-text {
      font-family:'JetBrains Mono',monospace;
      font-size:clamp(0.5rem,1.4vw,0.72rem);
      color:var(--comment);
    }
    .title-text span { color:var(--green); }

    .title-game {
      margin-left:auto;
      font-family:'JetBrains Mono',monospace;
      font-weight:800;
      font-size:clamp(0.75rem,2vw,1.05rem);
      color:var(--green);
      text-shadow:var(--glow-g);
      letter-spacing:4px;
    }
    .title-game::after { content:'_'; animation:blink 1s step-end infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

    /* â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hud {
      display:flex; align-items:center;
      justify-content:space-between;
      padding:5px 18px;
      background:var(--surface);
      border:1px solid var(--border); border-top:none;
      flex-shrink:0;
    }

    .hud-item  { display:flex; align-items:center; gap:10px; }
    .hud-label { font-size:clamp(0.36rem,1vw,0.48rem); color:var(--comment); letter-spacing:2px; }
    .hud-val   {
      font-family:'JetBrains Mono',monospace; font-weight:800;
      font-size:clamp(0.85rem,2.5vw,1.15rem);
      color:var(--green); text-shadow:var(--glow-g); min-width:38px;
    }
    .hud-val.amber { color:var(--amber); text-shadow:var(--glow-a); }

    .pip-row { display:flex; gap:5px; }
    .pip {
      width:13px; height:13px; border-radius:3px;
      background:var(--border); border:1px solid var(--green-dim);
      transition:all .2s;
    }
    .pip.on { background:var(--green); box-shadow:0 0 8px var(--green); }

    /* â”€â”€ Game area â€” takes ALL remaining height â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .game-area {
      position:relative;
      flex:1 1 auto;
      overflow:hidden;
      border:1px solid var(--border); border-top:none;
      box-shadow:
        inset 0 0 80px rgba(0,0,0,0.7),
        0 0 0 1px rgba(57,255,20,0.08),
        0 0 50px rgba(57,255,20,0.04);
    }

    #gameCanvas {
      display:block;
      /* fill container via CSS but drawn at exact pixel size */
      width:100%; height:100%;
      background:#080c10;
      outline:none;
    }

    /* â”€â”€ Overlays â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .overlay {
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:rgba(8,12,16,0.94);
      gap:clamp(10px,2.2vh,22px);
      transition:opacity .3s;
      padding:20px;
      z-index:50;
    }
    .overlay.hidden { opacity:0; pointer-events:none; }

    .ov-title {
      font-family:'JetBrains Mono',monospace;
      font-weight:800;
      font-size:clamp(1.5rem,5.5vw,3.2rem);
      letter-spacing:4px;
    }
    .ov-title.green { color:var(--green); text-shadow:var(--glow-g); animation:glitch 4s infinite; }
    .ov-title.red   { color:var(--red);   text-shadow:var(--glow-r); }

    @keyframes glitch {
      0%,93%,100%{text-shadow:var(--glow-g)}
      94%{text-shadow:-3px 0 var(--red),3px 0 var(--blue)}
      95%{text-shadow:3px 0 var(--red),-3px 0 var(--blue)}
      96%{text-shadow:var(--glow-g)}
    }

    .ov-code {
      font-family:'JetBrains Mono',monospace;
      font-size:clamp(0.52rem,1.5vw,0.75rem);
      color:var(--comment); line-height:2;
      background:var(--surface);
      border:1px solid var(--border);
      border-left:3px solid var(--green);
      border-radius:6px;
      padding:clamp(10px,2vh,18px) clamp(14px,3vw,28px);
      max-width:min(440px,88vw);
      text-align:left;
    }
    .kw  { color:var(--purple); }
    .fn  { color:var(--blue); }
    .str { color:var(--amber); }
    .num { color:var(--green); }
    .cmt { color:var(--comment); opacity:0.65; }
    .err { color:var(--red); }

    .ov-sub {
      font-size:clamp(0.42rem,1.3vw,0.6rem);
      color:var(--comment); text-align:center; line-height:2;
      max-width:min(380px,85vw);
    }
    .ov-sub .hl   { color:var(--green); }
    .ov-sub .hl-r { color:var(--red); }

    .crash-box {
      background:rgba(255,68,68,0.09);
      border:1px solid rgba(255,68,68,0.3);
      border-radius:6px;
      padding:clamp(8px,1.5vh,14px) clamp(14px,3vw,26px);
      font-family:'JetBrains Mono',monospace;
      font-size:clamp(0.5rem,1.5vw,0.68rem);
      color:var(--red); text-shadow:var(--glow-r);
      text-align:center; animation:fadeUp .4s ease;
    }
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    .ov-score {
      font-family:'JetBrains Mono',monospace; font-weight:800;
      font-size:clamp(1rem,3.5vw,1.6rem);
      color:var(--amber); text-shadow:var(--glow-a);
    }

    .ov-gomsg {
      font-size:clamp(0.42rem,1.3vw,0.58rem);
      color:var(--comment); text-align:center; line-height:2.2;
    }
    .ov-gomsg .hl  { color:var(--green); }
    .ov-gomsg .hl-a { color:var(--amber); }

    .btn-row { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }

    .btn {
      font-family:'Fira Code',monospace;
      font-size:clamp(0.48rem,1.4vw,0.62rem);
      padding:clamp(8px,1.5vh,13px) clamp(18px,3vw,30px);
      background:transparent;
      border:1px solid var(--green); color:var(--green);
      cursor:pointer; letter-spacing:2px;
      text-shadow:var(--glow-g); box-shadow:0 0 12px #39ff1422;
      border-radius:4px; transition:all .15s;
    }
    .btn:hover { background:var(--green); color:var(--bg); box-shadow:0 0 24px #39ff1488; text-shadow:none; }

    /* â”€â”€ Status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-bar {
        display: flex
    ;
        justify-content: space-between;
        align-items: center;
        padding: 20px 14px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-top: none;
        border-radius: 0 0 8px 8px;
        flex-shrink: 0;
    }
    .status-bar span { font-size:clamp(0.32rem,0.9vw,0.44rem); color:var(--comment); }
    .status-bar .mode { color:var(--green); margin-right:8px; font-weight:700; }
    .status-bar .live { color:var(--green-mid); }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position:fixed; bottom:22px; left:50%; transform:translateX(-50%);
      background:var(--surface); border:1px solid var(--green); border-radius:6px;
      padding:8px 22px;
      font-size:clamp(0.42rem,1.3vw,0.55rem);
      color:var(--green); text-shadow:var(--glow-g); letter-spacing:1px;
      z-index:1000; white-space:nowrap; pointer-events:none;
      animation:toastIn .3s ease, toastOut .3s ease 2.4s forwards;
    }
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    @keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(10px)}}

    /* â”€â”€ D-Pad â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .dpad {
      display:none;
      grid-template-columns:repeat(3,54px);
      grid-template-rows:repeat(3,54px);
      gap:5px; margin-top:6px;
    }
    @media (pointer:coarse),(max-width:520px){ .dpad{display:grid;} }
    .dpad-btn {
      background:rgba(57,255,20,0.07); border:1px solid rgba(57,255,20,0.25);
      color:var(--green); font-size:1.2rem; cursor:pointer; border-radius:6px;
      display:flex; align-items:center; justify-content:center;
      user-select:none; -webkit-tap-highlight-color:transparent; transition:background .1s;
    }
    .dpad-btn:active { background:rgba(57,255,20,0.25); }
    .dpad-empty { background:transparent; border:none; }
  </style>
</head>

<body>

<canvas id="matrix-bg"></canvas>

<div class="shell">

  <!-- Title bar -->
  <div class="title-bar">
    <div class="dot r"></div><div class="dot y"></div><div class="dot g"></div>
    <span class="title-text">Created BY $ <span>./BUCC R & D DEPARTMENT </span></span>
    <span class="title-game">BUG HUNT</span>
  </div>

  <!-- HUD -->
  <div class="hud">
    <div class="hud-item">
      <span class="hud-label">BUGS_EATEN</span>
      <span class="hud-val" id="score">0</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">CPU_SPEED</span>
      <div class="pip-row" id="pips">
        <div class="pip on"></div><div class="pip"></div><div class="pip"></div>
        <div class="pip"></div><div class="pip"></div>
      </div>
    </div>
    <div class="hud-item">
      <span class="hud-label">HIGH_SCORE</span>
      <span class="hud-val amber" id="best">0</span>
    </div>
  </div>

  <!-- Game area â€” flex:1 makes this take all remaining vertical space -->
  <div class="game-area" id="gameArea">
    <canvas id="gameCanvas" tabindex="0"></canvas>

    <!-- Start overlay -->
    <div class="overlay" id="startOverlay">
      <div class="ov-title green">BUG HUNT</div>
      <div class="ov-code">
        <span class="kw">while</span> (student.<span class="fn">isAlive</span>()) {<br>
        &nbsp;&nbsp;student.<span class="fn">eat</span>(<span class="str">"bugs"</span>); &nbsp;<span class="cmt">// nom nom</span><br>
        &nbsp;&nbsp;<span class="kw">if</span> (bugs % <span class="num">8</span> == <span class="num">0</span>) cpu_speed.<span class="fn">++</span>();<br>
        &nbsp;&nbsp;<span class="kw">if</span> (hitWall) &nbsp;&nbsp;<span class="err">throw</span> <span class="str">SegFaultException</span>;<br>
        &nbsp;&nbsp;<span class="kw">if</span> (ateSelf) &nbsp;&nbsp;<span class="err">throw</span> <span class="str">StackOverflowError</span>;<br>
        } <span class="cmt">// TODO: fix infinite loop ğŸ™ƒ</span>
      </div>
      <div class="ov-sub">
        You are <span class="hl">nullptr</span> â€” a rogue pointer devouring bugs.<br>
        Hit a wall = <span class="hl-r">segfault</span> &nbsp;Â·&nbsp; Eat yourself = <span class="hl-r">stack overflow</span>
      </div>
      <div class="btn-row">
        <button class="btn" id="startBtn" tabindex="-1">â–¶ RUN PROGRAM</button>
      </div>
      <div class="ov-sub" style="opacity:0.55;font-size:clamp(0.34rem,1vw,0.44rem)">
        WASD / ARROW KEYS &nbsp;Â·&nbsp; P = pause &nbsp;Â·&nbsp; ctrl+c = quit (just kidding)
      </div>
    </div>

    <!-- Game over overlay -->
    <div class="overlay hidden" id="gameOverOverlay">
      <div class="ov-title red" id="goTitle">SIGSEGV</div>
      <div class="crash-box" id="crashReason">Segmentation fault (core dumped)</div>
      <div class="ov-score" id="finalScore">bugs_eaten = 0</div>
      <div class="ov-gomsg" id="goMsg"></div>
      <div class="btn-row">
        <button class="btn" id="restartBtn" tabindex="-1">â†º RECOMPILE &amp; RUN</button>
      </div>
    </div>
  </div>

  <!-- Status bar -->
  <div class="status-bar">
    <span><span class="mode">INSERT</span>WASD / ARROWS &nbsp;Â·&nbsp; P = PAUSE</span>
    <span class="live" id="statusRight">ln:0 col:0 &nbsp;Â·&nbsp; python3 bughunt.py</span>
  </div>

  <!-- Mobile D-pad -->
  <div class="dpad">
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-up"    tabindex="-1">â–²</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-left"  tabindex="-1">â—€</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-right" tabindex="-1">â–¶</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-down"  tabindex="-1">â–¼</button>
    <div class="dpad-empty"></div>
  </div>

</div>

<script>
// â”€â”€ Matrix rain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
  const c=document.getElementById('matrix-bg'), x=c.getContext('2d');
  function rs(){ c.width=window.innerWidth; c.height=window.innerHeight; }
  rs(); window.addEventListener('resize',rs);
  const chars='01{}[];()<>=!&|^~%#@ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³'.split('');
  let drops=Array(Math.floor(c.width/16)).fill(1);
  setInterval(()=>{
    x.fillStyle='rgba(13,17,23,0.05)'; x.fillRect(0,0,c.width,c.height);
    x.fillStyle='#39ff14'; x.font='13px Fira Code';
    drops.forEach((y,i)=>{
      x.fillText(chars[Math.floor(Math.random()*chars.length)],i*16,y*16);
      if(y*16>c.height&&Math.random()>.975) drops[i]=0;
      drops[i]++;
    });
  },65);
})();

// â”€â”€ Canvas â€” sized to fill game-area exactly â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas   = document.getElementById('gameCanvas');
const ctx      = canvas.getContext('2d');
const gameArea = document.getElementById('gameArea');

const CELL = 24;          // 24px cells â€” big and clear
let COLS=0, ROWS=0;

function resizeCanvas(){
  const W=gameArea.clientWidth, H=gameArea.clientHeight;
  COLS=Math.floor(W/CELL); ROWS=Math.floor(H/CELL);
  canvas.width=COLS*CELL;  canvas.height=ROWS*CELL;
  // CSS size = container size so it doesn't over/under-fill
  canvas.style.width  = W+'px';
  canvas.style.height = H+'px';
  if(snake) draw();
}
window.addEventListener('resize', resizeCanvas);

// â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SPEEDS=[155,125,95,68,45];
const BUGS  =['ğŸ›','ğŸ’€','âš ï¸','ğŸ’£','ğŸ¦ ','ğŸ‘¾','â˜ ï¸','ğŸ”¥'];
const BUG_LABELS=[
  'NullPointerException','SegFault','MemoryLeak','HeapCorruption',
  'StackOverflow','UndefinedBehavior','InfiniteLoop','RaceCondition'
];
const DEATH_WALL=[
  'Segmentation fault (core dumped)',
  'Error: accessed memory at address 0x0000000',
  'Fatal: wall is not a valid memory address',
  'Exception: IndexOutOfBoundsException at boundary',
  'Bus error: 10 â€” invalid memory alignment',
  'Killed: process exceeded address space limit',
];
const DEATH_SELF=[
  'StackOverflowError: max recursion depth exceeded',
  'Fatal: circular dependency in snake.body[]',
  'Error: self-referential pointer dereference',
  'CyclicImportException: module imported itself',
  'git merge failed: cannot merge with itself',
  'Infinite loop O(âˆ) â€” professor is not amused',
];
const GO_MSGS=[
  ['Compiled fine. Crashed at runtime. Classic CSE.','ğŸ˜…'],
  ['Have you tried `git stash` and running again?','ğŸ”„'],
  ['This is going in the bug tracker as P0.','ğŸ›'],
  ['404: skill not found. Stack Overflow can\'t help you now.','ğŸ“š'],
  ['Your professor saw that. Push to GitHub anyway.','ğŸ‘€'],
  ['At least it\'s not the production database.','ğŸ˜‚'],
  ['printf("why\\n"); â€” every CSE student, 2am.','ğŸ’¬'],
  ['A linter would\'ve caught this. Just saying.','ğŸ”'],
  ['This is why we write unit tests. (Nobody writes unit tests.)','ğŸ§ª'],
  ['Rubber duck debugging failed. The duck quit.','ğŸ¦†'],
];
const TOASTS=[
  '// bug squashed! âœ…',
  'git commit -m "fixed a bug, broke 3 more"',
  '++bugs_eaten; // O(hunger)',
  'malloc() returned valid ptr ğŸ‰',
  'assert(bugs_eaten > 0); // passes',
  'cherry-picked that bug ğŸ’',
  'Garbage collected! â™»ï¸',
  'rm -rf ./bug',
  'heap snack acquired ğŸ“¦',
  '// TODO: delete this comment',
  'pip install patience',
  'segfault avoided! (this time)',
];

let snake,dir,nextDir,food,foodType;
let score=0,level=0,bugCount=0,paused=false,gameRunning=false,gameLoop;
let best=0;
try{best=parseInt(localStorage.getItem('bughunt_best')||'0')||0;}catch(_){}
document.getElementById('best').textContent=best;

const getSpeed=()=>SPEEDS[Math.min(level,SPEEDS.length-1)];
const rand=arr=>arr[Math.floor(Math.random()*arr.length)];

function updatePips(){
  document.querySelectorAll('.pip').forEach((p,i)=>p.classList.toggle('on',i<=level));
}

function placeFood(){
  let pos;
  do{pos={x:Math.floor(Math.random()*COLS),y:Math.floor(Math.random()*ROWS)};}
  while(snake.some(s=>s.x===pos.x&&s.y===pos.y));
  food=pos; foodType=Math.floor(Math.random()*BUGS.length);
}

function showToast(msg){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');
  t.className='toast'; t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2800);
}

function blurActive(){
  if(document.activeElement&&document.activeElement!==document.body)
    document.activeElement.blur();
}

// â”€â”€ Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame(){
  resizeCanvas();
  document.getElementById('startOverlay').classList.add('hidden');
  document.getElementById('gameOverOverlay').classList.add('hidden');

  const sx=Math.floor(COLS/2), sy=Math.floor(ROWS/2);
  snake=[{x:sx,y:sy},{x:sx-1,y:sy},{x:sx-2,y:sy},{x:sx-3,y:sy}];
  dir={x:1,y:0}; nextDir={x:1,y:0};
  score=0; level=0; bugCount=0; paused=false; gameRunning=true;
  updatePips();
  document.getElementById('score').textContent=0;
  document.getElementById('statusRight').textContent='running... pid:'+Math.floor(Math.random()*9000+1000);
  placeFood(); clearInterval(gameLoop);
  gameLoop=setInterval(tick,getSpeed());
  blurActive();
}

// â”€â”€ Tick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tick(){
  if(paused) return;
  dir={...nextDir};
  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  const wallHit=head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS;
  const selfHit=snake.some(s=>s.x===head.x&&s.y===head.y);
  if(wallHit||selfHit) return endGame(wallHit?'wall':'self');

  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){
    bugCount++; score+=10*(level+1);
    document.getElementById('score').textContent=score;
    document.getElementById('statusRight').textContent=`bugs:${bugCount}  score:${score}  level:${level+1}`;
    const nl=Math.min(Math.floor(bugCount/8),4);
    if(nl>level){
      level=nl; clearInterval(gameLoop);
      gameLoop=setInterval(tick,getSpeed()); updatePips();
      showToast(`ğŸš€ CPU_SPEED++ â†’ O(${['n','log n','âˆšn','logÂ²n','1'][level]})`);
    } else if(bugCount%3===0) showToast(rand(TOASTS));
    placeFood();
  } else { snake.pop(); }
}

// â”€â”€ End â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endGame(type){
  clearInterval(gameLoop); gameRunning=false;
  if(score>best){
    best=score;
    try{localStorage.setItem('bughunt_best',best);}catch(_){}
    document.getElementById('best').textContent=best;
  }
  const msg=rand(GO_MSGS);
  document.getElementById('goTitle').textContent    =type==='wall'?'SIGSEGV':'STACK OVERFLOW';
  document.getElementById('crashReason').textContent=rand(type==='wall'?DEATH_WALL:DEATH_SELF);
  document.getElementById('finalScore').textContent =`bugs_eaten = ${score}`;
  document.getElementById('goMsg').innerHTML=
    `<span class="hl">${msg[0]}</span> ${msg[1]}`+
    (score>0&&score>=best?'<br><span class="hl-a">// ğŸ† new high score! git commit -m "i am speed"</span>':'');
  document.getElementById('gameOverOverlay').classList.remove('hidden');
  document.getElementById('statusRight').textContent='EXIT_CODE: 139 | core dumped ğŸ’€';

  let f=0;
  const fi=setInterval(()=>{
    ctx.fillStyle=f%2===0?`rgba(255,${f%4===0?44:0},${f%4===0?0:180},0.22)`:'transparent';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    if(++f>=10) clearInterval(fi);
  },55);
}

// â”€â”€ Draw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath(); ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);     ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

function draw(){
  if(!COLS||!ROWS||!snake) return;

  // Background
  ctx.fillStyle='#080c10';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Grid lines â€” green tint, very subtle
  ctx.strokeStyle='rgba(57,255,20,0.055)';
  ctx.lineWidth=1;
  for(let x=0;x<=COLS;x++){
    ctx.beginPath();ctx.moveTo(x*CELL,0);ctx.lineTo(x*CELL,canvas.height);ctx.stroke();
  }
  for(let y=0;y<=ROWS;y++){
    ctx.beginPath();ctx.moveTo(0,y*CELL);ctx.lineTo(canvas.width,y*CELL);ctx.stroke();
  }

  // â”€â”€ Food
  const fx=food.x*CELL, fy=food.y*CELL;
  const pulse=0.5+0.5*Math.sin(Date.now()/260);

  // Glowing bg behind food
  ctx.save();
  ctx.shadowColor='#ff3333'; ctx.shadowBlur=18+pulse*16;
  ctx.fillStyle=`rgba(255,70,70,${0.11+pulse*0.11})`;
  roundRect(ctx,fx+2,fy+2,CELL-4,CELL-4,5); ctx.fill();
  ctx.restore();

  // Emoji (sized to cell)
  ctx.font=`${CELL-2}px serif`;
  ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(BUGS[foodType], fx+CELL/2, fy+CELL/2+1);

  // Bug label â€” pill above the cell
  const label=BUG_LABELS[foodType];
  const fs=Math.max(8,CELL*0.36);
  ctx.font=`bold ${fs}px Fira Code`;
  const lw=ctx.measureText(label).width;
  ctx.fillStyle='rgba(30,0,0,0.82)';
  ctx.fillRect(fx+CELL/2-lw/2-5, fy-fs-4, lw+10, fs+4);
  ctx.fillStyle='rgba(255,110,110,0.95)';
  ctx.textAlign='center'; ctx.textBaseline='bottom';
  ctx.fillText(label, fx+CELL/2, fy-2);

  // â”€â”€ Snake
  snake.forEach((seg,i)=>{
    const isHead=i===0, t=i/Math.max(snake.length,1);
    const x=seg.x*CELL, y=seg.y*CELL;
    const pad=isHead?1:2, r=isHead?7:4;

    ctx.save();
    if(isHead){
      ctx.shadowColor='#39ff14'; ctx.shadowBlur=22;
      ctx.fillStyle='#39ff14';
    } else {
      const b=Math.max(0.22,1-t*0.75);
      ctx.shadowColor=`rgba(57,255,20,${0.28*b})`;
      ctx.shadowBlur=7;
      ctx.fillStyle=`rgb(${Math.floor(8+b*25)},${Math.floor(b*215)},${Math.floor(b*18)})`;
    }
    roundRect(ctx,x+pad,y+pad,CELL-pad*2,CELL-pad*2,r);
    ctx.fill();

    // Array index on body segments (every 5th)
    if(!isHead&&i%5===0&&CELL>=22){
      ctx.fillStyle='rgba(57,255,20,0.2)';
      ctx.font=`${Math.max(7,CELL*0.3)}px Fira Code`;
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(`[${i}]`,x+CELL/2,y+CELL/2);
    }

    if(isHead){
      ctx.shadowBlur=0; ctx.fillStyle='#060a0e';
      const ew=Math.max(3,CELL*0.14), eh=ew;
      if(dir.x!==0){
        ctx.fillRect(x+CELL/2+dir.x*5,y+CELL*0.26,ew,eh);
        ctx.fillRect(x+CELL/2+dir.x*5,y+CELL*0.60,ew,eh);
      } else {
        ctx.fillRect(x+CELL*0.24,y+CELL/2+dir.y*5,ew,eh);
        ctx.fillRect(x+CELL*0.60,y+CELL/2+dir.y*5,ew,eh);
      }
      ctx.fillStyle='rgba(0,25,0,0.55)';
      ctx.font=`bold ${Math.max(7,CELL*0.3)}px Fira Code`;
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText('ptr',x+CELL/2,y+CELL/2);
    }
    ctx.restore();
  });

  // IDE-style coordinate display
  ctx.save();
  ctx.font=`${Math.max(9,CELL*0.38)}px Fira Code`;
  ctx.fillStyle='rgba(57,255,20,0.28)';
  ctx.textAlign='left'; ctx.textBaseline='top';
  ctx.fillText(`ptr[${snake[0].x},${snake[0].y}]  len:${snake.length}`,6,5);
  ctx.restore();
}

// â”€â”€ Animation loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animLoop(){ if(snake) draw(); requestAnimationFrame(animLoop); }

// Init â€” idle snake for start screen
resizeCanvas();
const SC=Math.max(5,Math.floor((COLS||20)/2));
const SR=Math.max(3,Math.floor((ROWS||10)/2));
snake=[{x:SC,y:SR},{x:SC-1,y:SR},{x:SC-2,y:SR},{x:SC-3,y:SR}];
dir={x:1,y:0}; food={x:SC+5,y:SR-2}; foodType=0;
animLoop();

// â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KEY_MAP={
  ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},
  w:{x:0,y:-1},s:{x:0,y:1},a:{x:-1,y:0},d:{x:1,y:0},
};
const GAME_KEYS=new Set(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d','W','A','S','D','p','P']);

function applyDir(nd){ if(!gameRunning)return; if(nd.x!==-dir.x||nd.y!==-dir.y) nextDir=nd; }

function handleKey(e){
  if(e.target.tagName==='INPUT') return;
  const k=e.key;
  if(!GAME_KEYS.has(k)) return;
  e.preventDefault();
  if(k==='p'||k==='P'){ if(gameRunning) paused=!paused; return; }
  const nd=KEY_MAP[k]||KEY_MAP[k.toLowerCase()];
  if(nd) applyDir(nd);
}
window.addEventListener('keydown',   handleKey,{capture:true});
document.addEventListener('keydown', handleKey,{capture:true});

document.getElementById('startBtn').addEventListener('click',  ()=>{startGame();blurActive();});
document.getElementById('restartBtn').addEventListener('click',()=>{startGame();blurActive();});

[['btn-up',{x:0,y:-1}],['btn-down',{x:0,y:1}],['btn-left',{x:-1,y:0}],['btn-right',{x:1,y:0}]]
  .forEach(([id,nd])=>document.getElementById(id).addEventListener('click',()=>{applyDir(nd);blurActive();}));

let ts=null;
canvas.addEventListener('touchstart',e=>{ts=e.touches[0];e.preventDefault();},{passive:false});
canvas.addEventListener('touchend',e=>{
  if(!ts)return;
  const dx=e.changedTouches[0].clientX-ts.clientX, dy=e.changedTouches[0].clientY-ts.clientY;
  if(Math.abs(dx)>Math.abs(dy)) applyDir(dx>0?{x:1,y:0}:{x:-1,y:0});
  else                          applyDir(dy>0?{x:0,y:1}:{x:0,y:-1});
  e.preventDefault();
},{passive:false});
</script>
</body>
</html>