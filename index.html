<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BUG HUNT â€” CSE Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:       #0d1117;
      --surface:  #161b22;
      --border:   #30363d;
      --green:    #39ff14;
      --green-dim:#1a7a00;
      --amber:    #ffb800;
      --red:      #ff4444;
      --blue:     #58a6ff;
      --purple:   #bc8cff;
      --comment:  #8b949e;
      --text:     #e6edf3;
      --glow-g:   0 0 10px #39ff1466, 0 0 30px #39ff1422;
      --glow-a:   0 0 10px #ffb80066;
      --glow-r:   0 0 10px #ff444466;
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Fira Code', monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* Matrix rain background */
    #matrix-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      opacity: 0.07;
      pointer-events: none;
    }

    /* CRT scanlines */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg, transparent, transparent 3px,
        rgba(0,0,0,0.15) 3px, rgba(0,0,0,0.15) 4px
      );
      pointer-events: none;
      z-index: 200;
    }

    .page {
      position: relative;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      padding: 16px;
    }

    /* â”€â”€ Title bar (like a terminal window) â”€â”€ */
    .terminal-bar {
      width: 100%;
      max-width: 500px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px 10px 0 0;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dot { width:12px;height:12px;border-radius:50%; }
    .dot.r{background:#ff5f57;} .dot.y{background:#febc2e;} .dot.g{background:#28c840;}

    .terminal-title {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      color: var(--comment);
      margin-left: 6px;
      letter-spacing: 1px;
    }

    .terminal-title span { color: var(--green); }

    /* â”€â”€ Main title â”€â”€ */
    .game-title {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 800;
      font-size: clamp(1.4rem, 5vw, 2.6rem);
      color: var(--green);
      text-shadow: var(--glow-g);
      letter-spacing: 4px;
      position: relative;
    }

    .game-title::after {
      content: '_';
      animation: blink-cursor 1s step-end infinite;
    }

    @keyframes blink-cursor { 0%,100%{opacity:1} 50%{opacity:0} }

    .game-subtitle {
      font-size: 0.55rem;
      color: var(--comment);
      letter-spacing: 2px;
    }

    .game-subtitle span { color: var(--amber); }

    /* â”€â”€ HUD â”€â”€ */
    .hud {
      width: 100%;
      max-width: 500px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-top: none;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.5rem;
    }

    .hud-item { display:flex;flex-direction:column;gap:3px;align-items:center; }
    .hud-key  { color:var(--comment);letter-spacing:2px; }
    .hud-val  { color:var(--green);font-size:0.9rem;font-weight:700;text-shadow:var(--glow-g); }
    .hud-val.amber { color:var(--amber);text-shadow:var(--glow-a); }

    .level-pips { display:flex;gap:4px; }
    .pip { width:10px;height:10px;border-radius:2px;background:var(--border);border:1px solid var(--green-dim);transition:all .2s; }
    .pip.on { background:var(--green);box-shadow:0 0 6px var(--green); }

    /* â”€â”€ Game wrapper â”€â”€ */
    .game-wrapper {
      position: relative;
      border: 1px solid var(--border);
      border-top: none;
      box-shadow: 0 0 0 1px #39ff1422, 0 20px 60px #00000088;
    }

    canvas { display:block;background:var(--bg);outline:none; }

    /* â”€â”€ Overlays â”€â”€ */
    .overlay {
      position:absolute;inset:0;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      background: rgba(13,17,23,0.95);
      gap:14px;
      transition:opacity 0.3s;
      padding: 20px;
    }
    .overlay.hidden { opacity:0;pointer-events:none; }

    /* Code block style title */
    .ov-code {
      font-family:'JetBrains Mono',monospace;
      font-size:0.55rem;
      color:var(--comment);
      text-align:center;
      line-height:1.8;
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:6px;
      padding:12px 20px;
      max-width:340px;
    }

    .ov-code .kw   { color:var(--purple); }
    .ov-code .fn   { color:var(--blue); }
    .ov-code .str  { color:var(--amber); }
    .ov-code .num  { color:var(--green); }
    .ov-code .cmt  { color:var(--comment); }
    .ov-code .err  { color:var(--red); }

    .ov-title {
      font-family:'JetBrains Mono',monospace;
      font-weight:800;
      font-size:clamp(1rem,3vw,1.8rem);
      letter-spacing:3px;
      animation:glitch 3s infinite;
    }

    @keyframes glitch {
      0%,95%,100%{text-shadow:var(--glow-g)}
      96%{text-shadow:-2px 0 var(--red),2px 0 var(--blue)}
      97%{text-shadow:2px 0 var(--red),-2px 0 var(--blue)}
      98%{text-shadow:var(--glow-g)}
    }

    .ov-score {
      font-size:1.2rem;
      font-weight:700;
      color:var(--amber);
      text-shadow:var(--glow-a);
    }

    .ov-msg {
      font-size:0.45rem;
      color:var(--comment);
      text-align:center;
      line-height:2;
      max-width:300px;
    }

    .ov-msg .hl { color:var(--green); }
    .ov-msg .hl-r { color:var(--red); }

    .crash-reason {
      font-size:0.48rem;
      color:var(--red);
      text-shadow:var(--glow-r);
      text-align:center;
      font-family:'JetBrains Mono',monospace;
      animation:fadeIn .4s ease;
      background: rgba(255,68,68,0.08);
      border:1px solid rgba(255,68,68,0.2);
      border-radius:4px;
      padding: 8px 16px;
    }

    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    /* Buttons */
    .btn-row { display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:4px; }

    .btn {
      font-family:'Fira Code',monospace;
      font-size:0.5rem;
      padding:9px 20px;
      background:transparent;
      border:1px solid var(--green);
      color:var(--green);
      cursor:pointer;
      letter-spacing:2px;
      text-shadow:var(--glow-g);
      box-shadow:0 0 10px #39ff1422;
      border-radius:4px;
      transition:all 0.15s;
    }
    .btn:hover { background:var(--green);color:var(--bg);box-shadow:0 0 20px #39ff1466;text-shadow:none; }
    .btn.amber { border-color:var(--amber);color:var(--amber);text-shadow:var(--glow-a); }
    .btn.amber:hover { background:var(--amber);color:var(--bg); }

    /* â”€â”€ Status bar (bottom) â”€â”€ */
    .status-bar {
      width:100%;max-width:500px;
      background:var(--surface);border:1px solid var(--border);border-top:none;
      padding:5px 14px;display:flex;justify-content:space-between;align-items:center;
    }
    .status-left  { font-size:0.38rem;color:var(--comment); }
    .status-right { font-size:0.38rem;color:var(--green-dim); }
    .status-left .mode { color:var(--green);margin-right:10px; }

    /* â”€â”€ Toast notification (fun messages) â”€â”€ */
    .toast {
      position:fixed;bottom:24px;left:50%;transform:translateX(-50%);
      background:var(--surface);border:1px solid var(--green);
      border-radius:6px;padding:8px 18px;
      font-size:0.42rem;color:var(--green);
      text-shadow:var(--glow-g);letter-spacing:1px;
      z-index:300;
      animation:toastIn .3s ease, toastOut .3s ease 2.2s forwards;
      white-space:nowrap;
      pointer-events:none;
    }
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    @keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(10px)}}

    /* â”€â”€ D-Pad (mobile) â”€â”€ */
    .dpad { display:none;grid-template-columns:repeat(3,48px);grid-template-rows:repeat(3,48px);gap:4px; }
    @media (pointer:coarse),(max-width:480px){.dpad{display:grid}}
    .dpad-btn {
      background:rgba(57,255,20,0.06);border:1px solid rgba(57,255,20,0.2);
      color:var(--green);font-size:1rem;cursor:pointer;border-radius:4px;
      display:flex;align-items:center;justify-content:center;
      user-select:none;-webkit-tap-highlight-color:transparent;transition:background .1s;
    }
    .dpad-btn:active{background:rgba(57,255,20,0.2);}
    .dpad-empty{background:transparent;border:none;}
  </style>
</head>
<body>

<canvas id="matrix-bg"></canvas>

<div class="page">

  <!-- Terminal title bar -->
  <div class="terminal-bar">
    <div class="dot r"></div><div class="dot y"></div><div class="dot g"></div>
    <span class="terminal-title">student@cse-lab:~$ <span>./bughunt --mode=survival</span></span>
  </div>

  <!-- Game title -->
  <div class="game-title">BUG HUNT</div>
  <div class="game-subtitle">// <span>CSE Edition</span> â€” eat bugs, don't segfault</div>

  <!-- HUD -->
  <div class="hud">
    <div class="hud-item">
      <span class="hud-key">BUGS_EATEN</span>
      <span class="hud-val" id="score">0</span>
    </div>
    <div class="hud-item">
      <span class="hud-key">CPU_SPEED</span>
      <div class="level-pips" id="pips">
        <div class="pip on"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div><div class="pip"></div>
      </div>
    </div>
    <div class="hud-item">
      <span class="hud-key">HIGH_SCORE</span>
      <span class="hud-val amber" id="best">0</span>
    </div>
  </div>

  <!-- Game canvas -->
  <div class="game-wrapper">
    <canvas id="gameCanvas" width="480" height="400" tabindex="0"></canvas>

    <!-- Start overlay -->
    <div class="overlay" id="startOverlay">
      <div class="ov-title" style="color:var(--green)">BUG HUNT</div>
      <div class="ov-code">
        <span class="kw">while</span> (student.<span class="fn">isAlive</span>()) {<br>
        &nbsp;&nbsp;student.<span class="fn">eat</span>(<span class="str">"bugs"</span>);<br>
        &nbsp;&nbsp;<span class="cmt">// avoid segfaults!</span><br>
        &nbsp;&nbsp;<span class="kw">if</span> (bugs_eaten % <span class="num">8</span> == <span class="num">0</span>)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;cpu_speed.<span class="fn">increment</span>();<br>
        }<br>
        <span class="err">// TODO: fix infinite loop</span>
      </div>
      <div class="ov-msg">
        You are <span class="hl">nullptr</span> â€” a rogue pointer eating bugs.<br>
        Don't hit the walls (that's a <span class="hl-r">segfault</span>).<br>
        Don't eat yourself (that's a <span class="hl-r">stack overflow</span>).
      </div>
      <div class="btn-row">
        <button class="btn" id="startBtn" tabindex="-1">â–¶ RUN PROGRAM</button>
      </div>
      <div class="ov-msg" style="font-size:0.38rem">WASD / ARROW KEYS Â· P = pause Â· ctrl+c = quit (just kidding)</div>
    </div>

    <!-- Game over overlay -->
    <div class="overlay hidden" id="gameOverOverlay">
      <div class="ov-title" style="color:var(--red)" id="goTitle">SEGFAULT</div>
      <div class="crash-reason" id="crashReason">Segmentation fault (core dumped)</div>
      <div class="ov-score" id="finalScore">bugs_eaten = 0</div>
      <div class="ov-msg" id="goMsg"></div>
      <div class="btn-row">
        <button class="btn" id="restartBtn" tabindex="-1">â†º RECOMPILE</button>
      </div>
    </div>
  </div>

  <!-- Status bar -->
  <div class="status-bar">
    <div class="status-left"><span class="mode">INSERT</span> WASD/ARROWS Â· P=PAUSE</div>
    <div class="status-right" id="statusRight">ln:0 col:0 | python3 bughunt.py</div>
  </div>

  <!-- Mobile D-Pad -->
  <div class="dpad">
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-up"    tabindex="-1">â–²</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-left"  tabindex="-1">â—€</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-right" tabindex="-1">â–¶</button>
    <div class="dpad-empty"></div>
    <button class="dpad-btn" id="btn-down"  tabindex="-1">â–¼</button>
    <div class="dpad-empty"></div>
  </div>

</div>

<script>
// â”€â”€ Matrix rain background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  const c = document.getElementById('matrix-bg');
  const x = c.getContext('2d');
  function resize() { c.width=window.innerWidth; c.height=window.innerHeight; }
  resize();
  window.addEventListener('resize', resize);
  const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³{}[];()<>=!&|^~%#@'.split('');
  const cols  = Math.floor(window.innerWidth / 16);
  const drops = Array(cols).fill(1);
  setInterval(() => {
    x.fillStyle='rgba(13,17,23,0.05)';
    x.fillRect(0,0,c.width,c.height);
    x.fillStyle='#39ff14';
    x.font='14px Fira Code';
    drops.forEach((y,i) => {
      x.fillText(chars[Math.floor(Math.random()*chars.length)], i*16, y*16);
      if(y*16>c.height && Math.random()>.975) drops[i]=0;
      drops[i]++;
    });
  }, 60);
})();

// â”€â”€ Game setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('gameCanvas');
const ctx    = canvas.getContext('2d');
const CELL   = 20;
const COLS   = canvas.width  / CELL;
const ROWS   = canvas.height / CELL;
const SPEEDS = [160, 130, 100, 72, 48];

// CSE-themed bug emojis / symbols drawn on food
const BUGS = ['ğŸ›','ğŸ’€','âš ï¸','ğŸ”´','ğŸ’£','ğŸ¦ ','ğŸ‘¾','â˜ ï¸'];
const BUG_LABELS = ['NullPointerException','SegFault','MemoryLeak','InfiniteLoop','StackOverflow','HeapCorrupt','UndefinedBehavior','RaceCondition'];

// Fun death messages
const DEATH_WALL = [
  'Segmentation fault (core dumped)',
  'Error: accessed memory outside bounds',
  'Process killed: Out of stack space',
  'Fatal: wall is not a valid memory address',
  'Exception: IndexOutOfBoundsException',
  'Bus error: 10',
];
const DEATH_SELF = [
  'StackOverflowError: recursion depth exceeded',
  'Fatal: snake ate its own tail (circular dependency)',
  'Error: self-referential pointer dereference',
  'Infinite loop detected â€” killing process',
  'Caught: CyclicImportException',
  'git error: cannot merge with itself',
];
const GO_MSGS = [
  ['Your code compiled but crashed at runtime. Classic.', 'ğŸ˜…'],
  ['Have you tried turning it off and on again?', 'ğŸ”„'],
  ['That\'s going in the bug tracker.', 'ğŸ›'],
  ['404: skill not found. Keep practicing!', 'ğŸ“š'],
  ['Your professor is watching. Git push and try again.', 'ğŸ‘€'],
  ['At least it\'s not a production server.', 'ğŸ˜‚'],
  ['printf("help\\n"); â€” every CSE student ever', 'ğŸ’¬'],
  ['This would\'ve been caught by a linter.', 'ğŸ”'],
];
const TOASTS = [
  '// bug squashed!',
  'git commit -m "fixed a bug"',
  '++bugs_eaten; // O(n)',
  'Garbage collected! â™»ï¸',
  'malloc() success!',
  'assert(bugs > 0);',
  'cherry-picked that bug ğŸ’',
  'O(1) snack!',
  'heap allocated snack ğŸ‰',
  'rm -rf bug/',
];

let snake, dir, nextDir, food, foodType;
let score, level, paused, gameRunning, gameLoop, bugCount;
let best = 0;
try { best = parseInt(localStorage.getItem('bughunt_best')||'0')||0; } catch(_) {}
document.getElementById('best').textContent = best;

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const getSpeed = () => SPEEDS[Math.min(level, SPEEDS.length-1)];
const rand = (arr) => arr[Math.floor(Math.random()*arr.length)];

function updatePips() {
  document.querySelectorAll('.pip').forEach((p,i)=>p.classList.toggle('on', i<=level));
}

function placeFood() {
  let pos;
  do { pos={x:Math.floor(Math.random()*COLS),y:Math.floor(Math.random()*ROWS)}; }
  while (snake.some(s=>s.x===pos.x&&s.y===pos.y));
  food = pos;
  foodType = Math.floor(Math.random()*BUGS.length);
}

function showToast(msg) {
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t = document.createElement('div');
  t.className='toast'; t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 2600);
}

function blurActive() {
  if(document.activeElement && document.activeElement!==document.body)
    document.activeElement.blur();
}

// â”€â”€ Start / Restart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame() {
  document.getElementById('startOverlay').classList.add('hidden');
  document.getElementById('gameOverOverlay').classList.add('hidden');

  snake   = [{x:12,y:10},{x:11,y:10},{x:10,y:10},{x:9,y:10}];
  dir     = {x:1,y:0};
  nextDir = {x:1,y:0};
  score   = 0; level=0; bugCount=0; paused=false; gameRunning=true;

  updatePips();
  document.getElementById('score').textContent = 0;
  document.getElementById('statusRight').textContent = 'ln:0 col:0 | running...';
  placeFood();
  clearInterval(gameLoop);
  gameLoop = setInterval(tick, getSpeed());
  blurActive();
}

// â”€â”€ Tick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tick() {
  if(paused) return;
  dir = {...nextDir};
  const head = {x:snake[0].x+dir.x, y:snake[0].y+dir.y};

  const wallHit = head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS;
  const selfHit = snake.some(s=>s.x===head.x&&s.y===head.y);

  if(wallHit||selfHit) return endGame(wallHit?'wall':'self');

  snake.unshift(head);

  if(head.x===food.x && head.y===food.y) {
    bugCount++;
    score += 10*(level+1);
    document.getElementById('score').textContent = score;
    document.getElementById('statusRight').textContent =
      `bugs:${bugCount} score:${score} | level ${level+1}`;

    // Level up every 8 bugs
    const nl = Math.min(Math.floor(bugCount/8), 4);
    if(nl>level) {
      level=nl; clearInterval(gameLoop);
      gameLoop=setInterval(tick,getSpeed()); updatePips();
      showToast(`ğŸš€ CPU_SPEED++ // now O(${['n','log n','âˆšn','logÂ²n','1'][level]})`);
    } else {
      // Show fun toast occasionally
      if(bugCount%3===0) showToast(rand(TOASTS));
    }
    placeFood();
  } else {
    snake.pop();
  }
  draw();
}

// â”€â”€ End game â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function endGame(type) {
  clearInterval(gameLoop);
  gameRunning = false;

  if(score>best) {
    best=score;
    try{localStorage.setItem('bughunt_best',best);}catch(_){}
    document.getElementById('best').textContent=best;
  }

  const isWall = type==='wall';
  const reasons = isWall ? DEATH_WALL : DEATH_SELF;
  const goMsg   = rand(GO_MSGS);

  document.getElementById('goTitle').textContent     = isWall ? 'SIGSEGV' : 'STACK OVERFLOW';
  document.getElementById('crashReason').textContent = rand(reasons);
  document.getElementById('finalScore').textContent  = `bugs_eaten = ${score}`;
  document.getElementById('goMsg').innerHTML =
    `<span class="hl">${goMsg[0]}</span> ${goMsg[1]}` +
    (score>=best && score>0 ? '<br><span class="hl">// ğŸ† new high score!</span>' : '');

  document.getElementById('gameOverOverlay').classList.remove('hidden');
  document.getElementById('statusRight').textContent = `EXIT_CODE: 139 | core dumped`;

  // Glitch flash
  let f=0;
  const fi=setInterval(()=>{
    ctx.fillStyle=f%2===0?`rgba(255,${f%4===0?68:0},${f%4===0?0:200},0.2)`:'transparent';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    if(++f>=8) clearInterval(fi);
  },60);
}

// â”€â”€ Draw â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function draw() {
  // Background
  ctx.fillStyle='#0d1117';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Grid (subtle)
  ctx.strokeStyle='rgba(48,54,61,0.4)';
  ctx.lineWidth=0.5;
  for(let x=0;x<=COLS;x++){
    ctx.beginPath();ctx.moveTo(x*CELL,0);ctx.lineTo(x*CELL,canvas.height);ctx.stroke();
  }
  for(let y=0;y<=ROWS;y++){
    ctx.beginPath();ctx.moveTo(0,y*CELL);ctx.lineTo(canvas.width,y*CELL);ctx.stroke();
  }

  // Food â€” draw bug label above it
  const fx=food.x*CELL, fy=food.y*CELL;

  // Pulsing glow under food
  const pulse = 0.5+0.5*Math.sin(Date.now()/300);
  ctx.save();
  ctx.shadowColor='#ff4444';
  ctx.shadowBlur=10+pulse*10;
  ctx.fillStyle=`rgba(255,68,68,${0.12+pulse*0.08})`;
  ctx.fillRect(fx+1,fy+1,CELL-2,CELL-2);
  ctx.restore();

  // Bug emoji
  ctx.font=`${CELL-2}px serif`;
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(BUGS[foodType], fx+CELL/2, fy+CELL/2+1);

  // Bug label above
  ctx.font='bold 7px Fira Code';
  ctx.fillStyle='rgba(255,68,68,0.7)';
  ctx.fillText(BUG_LABELS[foodType], fx+CELL/2, fy-3);

  // Snake â€” looks like code tokens
  snake.forEach((seg,i)=>{
    const isHead=i===0;
    const t=i/snake.length;
    const x=seg.x*CELL, y=seg.y*CELL;

    ctx.save();
    if(isHead){
      ctx.shadowColor='#39ff14';
      ctx.shadowBlur=14;
      ctx.fillStyle='#39ff14';
    } else {
      ctx.shadowColor='rgba(57,255,20,0.2)';
      ctx.shadowBlur=4;
      // Gradient from green to dim
      const g=Math.floor(255*(1-t*0.7));
      ctx.fillStyle=`rgb(0,${g},0)`;
    }

    // Rounded body
    const pad=isHead?1:2, r=isHead?5:3;
    roundRect(ctx,x+pad,y+pad,CELL-pad*2,CELL-pad*2,r);
    ctx.fill();

    // Head details
    if(isHead){
      // Eyes
      ctx.shadowBlur=0;
      ctx.fillStyle='#0d1117';
      if(dir.x!==0){
        ctx.fillRect(x+CELL/2+dir.x*4, y+5, 3,3);
        ctx.fillRect(x+CELL/2+dir.x*4, y+CELL-8, 3,3);
      } else {
        ctx.fillRect(x+5, y+CELL/2+dir.y*4, 3,3);
        ctx.fillRect(x+CELL-8, y+CELL/2+dir.y*4, 3,3);
      }

      // Label "ptr" on head
      ctx.fillStyle='rgba(57,255,20,0.5)';
      ctx.font='bold 6px Fira Code';
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      ctx.fillText('ptr', x+CELL/2, y+CELL/2);
    }

    ctx.restore();
  });

  // Coordinate display (like an IDE)
  ctx.font='9px Fira Code';
  ctx.fillStyle='rgba(139,148,158,0.4)';
  ctx.textAlign='left';
  ctx.textBaseline='top';
  ctx.fillText(`[${snake[0].x},${snake[0].y}]`, 4, 4);
}

function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);    ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

// Request animation frame for smooth food pulse
function animLoop() {
  if(gameRunning && !paused) draw();
  requestAnimationFrame(animLoop);
}
// Initial draw
snake=[{x:12,y:10},{x:11,y:10},{x:10,y:10},{x:9,y:10}];
dir={x:1,y:0}; food={x:16,y:8}; foodType=0; draw();
animLoop();

// â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KEY_MAP = {
  ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0},
  w:{x:0,y:-1},s:{x:0,y:1},a:{x:-1,y:0},d:{x:1,y:0},
};
const GAME_KEYS=new Set(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d','W','A','S','D','p','P']);

function applyDir(nd){
  if(!gameRunning)return;
  if(nd.x!==-dir.x||nd.y!==-dir.y) nextDir=nd;
}

function handleKey(e){
  if(e.target.tagName==='INPUT') return;
  const k=e.key;
  if(!GAME_KEYS.has(k)) return;
  e.preventDefault();
  if(k==='p'||k==='P'){ if(gameRunning) paused=!paused; return; }
  const nd=KEY_MAP[k]||KEY_MAP[k.toLowerCase()];
  if(nd) applyDir(nd);
}

window.addEventListener('keydown',   handleKey, {capture:true});
document.addEventListener('keydown', handleKey, {capture:true});

document.getElementById('startBtn').addEventListener('click',   ()=>{startGame();blurActive();});
document.getElementById('restartBtn').addEventListener('click', ()=>{startGame();blurActive();});

[['btn-up',{x:0,y:-1}],['btn-down',{x:0,y:1}],['btn-left',{x:-1,y:0}],['btn-right',{x:1,y:0}]]
  .forEach(([id,nd])=>document.getElementById(id).addEventListener('click',()=>{applyDir(nd);blurActive();}));

let ts=null;
canvas.addEventListener('touchstart',e=>{ts=e.touches[0];e.preventDefault();},{passive:false});
canvas.addEventListener('touchend',e=>{
  if(!ts)return;
  const dx=e.changedTouches[0].clientX-ts.clientX, dy=e.changedTouches[0].clientY-ts.clientY;
  if(Math.abs(dx)>Math.abs(dy)) applyDir(dx>0?{x:1,y:0}:{x:-1,y:0});
  else                          applyDir(dy>0?{x:0,y:1}:{x:0,y:-1});
  e.preventDefault();
},{passive:false});
</script>
</body>
</html>